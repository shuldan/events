# `events` â€” Ð’Ñ‹ÑÐ¾ÐºÐ¾Ð¿Ñ€Ð¾Ð¸Ð·Ð²Ð¾Ð´Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ð´Ð¸ÑÐ¿ÐµÑ‚Ñ‡ÐµÑ€ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹ Ñ Ð¿Ð¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ¾Ð¹ Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð¾ÑÑ‚Ð¸

[![Go CI](https://github.com/shuldan/events/workflows/Go%20CI/badge.svg)](https://github.com/shuldan/events/actions)
[![codecov](https://codecov.io/gh/shuldan/events/branch/main/graph/badge.svg)](https://codecov.io/gh/shuldan/events)
[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](https://opensource.org/licenses/MIT)

ÐŸÐ°ÐºÐµÑ‚ `events` Ð¿Ñ€ÐµÐ´Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ Ñ‚Ð¸Ð¿Ð¾Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ñ‹Ð¹, Ð¾Ñ‚ÐºÐ°Ð·Ð¾ÑƒÑÑ‚Ð¾Ð¹Ñ‡Ð¸Ð²Ñ‹Ð¹ Ð¸ Ð³Ð¸Ð±ÐºÐ¸Ð¹ Ð´Ð¸ÑÐ¿ÐµÑ‚Ñ‡ÐµÑ€ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹ (event bus) Ð´Ð»Ñ Go-Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ð¹. ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÑ‚ ÐºÐ°Ðº ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½ÑƒÑŽ, Ñ‚Ð°Ðº Ð¸ Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½ÑƒÑŽ Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÑƒ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹, Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÑƒ Ð¾ÑˆÐ¸Ð±Ð¾Ðº, Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð¾ÑÐ»Ðµ Ð¿Ð°Ð½Ð¸Ðº Ð¸ Ð½Ð°ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÐµÐ¼Ð¾Ðµ ÐºÐ¾Ð»Ð¸Ñ‡ÐµÑÑ‚Ð²Ð¾ Ð²Ð¾Ñ€ÐºÐµÑ€Ð¾Ð² Ð´Ð»Ñ Ð¿Ð°Ñ€Ð°Ð»Ð»ÐµÐ»ÑŒÐ½Ð¾Ð¹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸.

---

## ðŸš€ ÐžÑÐ½Ð¾Ð²Ð½Ñ‹Ðµ Ð²Ð¾Ð·Ð¼Ð¾Ð¶Ð½Ð¾ÑÑ‚Ð¸

- **Ð¢Ð¸Ð¿Ð¾Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð°Ñ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐºÐ°**: ÑÑ‚Ñ€Ð¾Ð³Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ¸Ð³Ð½Ð°Ñ‚ÑƒÑ€ ÑÐ»ÑƒÑˆÐ°Ñ‚ÐµÐ»ÐµÐ¹ Ð½Ð° ÑÑ‚Ð°Ð¿Ðµ Ñ€ÐµÐ³Ð¸ÑÑ‚Ñ€Ð°Ñ†Ð¸Ð¸.
- **Ð”Ð²Ð° Ñ€ÐµÐ¶Ð¸Ð¼Ð° Ð´Ð¾ÑÑ‚Ð°Ð²ÐºÐ¸**: ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ñ‹Ð¹ (Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ Ð²Ñ‹ÐºÐ»ÑŽÑ‡ÐµÐ½) Ð¸ Ð°ÑÐ¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ñ‹Ð¹ (Ð¿Ð¾ ÑƒÐ¼Ð¾Ð»Ñ‡Ð°Ð½Ð¸ÑŽ Ð²ÐºÐ»ÑŽÑ‡Ñ‘Ð½).
- **ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶ÐºÐ° Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¹ Ð¸ Ð¼ÐµÑ‚Ð¾Ð´Ð¾Ð²**: ÑÐ»ÑƒÑˆÐ°Ñ‚ÐµÐ»ÑÐ¼Ð¸ Ð¼Ð¾Ð³ÑƒÑ‚ Ð±Ñ‹Ñ‚ÑŒ ÐºÐ°Ðº Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ `func(ctx, Event) error`, Ñ‚Ð°Ðº Ð¸ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹ Ñ Ð¼ÐµÑ‚Ð¾Ð´Ð¾Ð¼ `Handle(ctx, Event) error`.
- **Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¿Ð¾ÑÐ»Ðµ Ð¿Ð°Ð½Ð¸Ðº**: Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð¿ÐµÑ€ÐµÑ…Ð²Ð°Ñ‚ Ð¿Ð°Ð½Ð¸Ðº Ð² Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ°Ñ… ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹.
- **Ð“Ð¸Ð±ÐºÐ°Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ð¾ÑˆÐ¸Ð±Ð¾Ðº**: ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ðµ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸ÐºÐ¸ Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð¸ Ð¿Ð°Ð½Ð¸Ðº Ñ‡ÐµÑ€ÐµÐ· Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÑ‹.
- **ÐšÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð½Ð°Ñ Ð¾Ñ‚Ð¼ÐµÐ½Ð°**: ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð°Ñ Ñ€ÐµÐ°ÐºÑ†Ð¸Ñ Ð½Ð° Ð¾Ñ‚Ð¼ÐµÐ½Ñƒ ÐºÐ¾Ð½Ñ‚ÐµÐºÑÑ‚Ð° Ð¿Ñ€Ð¸ Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸Ð¸.
- **ÐŸÐ¾Ñ‚Ð¾ÐºÐ¾Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ÑÑ‚ÑŒ**: Ð¼Ð¾Ð¶Ð½Ð¾ Ð±ÐµÐ·Ð¾Ð¿Ð°ÑÐ½Ð¾ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð¸Ð· Ð½ÐµÑÐºÐ¾Ð»ÑŒÐºÐ¸Ñ… Ð³Ð¾Ñ€ÑƒÑ‚Ð¸Ð½.

---

## ðŸ“¦ Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°

Ð¢Ñ€ÐµÐ±ÑƒÐµÑ‚ÑÑ **Go 1.24+**.

```sh
go get github.com/shuldan/events
```

---

## ðŸ› ï¸ Ð Ð°Ð±Ð¾Ñ‚Ð° Ñ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð¾Ð¼

### Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¸Ð½ÑÑ‚Ñ€ÑƒÐ¼ÐµÐ½Ñ‚Ð¾Ð²

```sh
make install-tools
```

Ð£ÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÑ‚:
- `golangci-lint` (v2.4.0)
- `goimports`
- `gosec`

### Ð›Ð¾ÐºÐ°Ð»ÑŒÐ½Ð°Ñ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°

```sh
make all
```

Ð’Ñ‹Ð¿Ð¾Ð»Ð½ÑÐµÑ‚:
- Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÑƒ Ñ„Ð¾Ñ€Ð¼Ð°Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ñ,
- ÑÑ‚Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ Ð°Ð½Ð°Ð»Ð¸Ð·,
- security-ÑÐºÐ°Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ,
- Ð·Ð°Ð¿ÑƒÑÐº Ñ‚ÐµÑÑ‚Ð¾Ð².

### CI-Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ°

```sh
make ci
```

ÐÐ½Ð°Ð»Ð¾Ð³Ð¸Ñ‡Ð½Ð¾ Ñ‚Ð¾Ð¼Ñƒ, Ñ‡Ñ‚Ð¾ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ Ð² GitHub Actions.

---

## ðŸ§± ÐÑ€Ñ…Ð¸Ñ‚ÐµÐºÑ‚ÑƒÑ€Ð°

### `Dispatcher`

ÐžÑÐ½Ð¾Ð²Ð½Ð¾Ð¹ Ð¾Ð±ÑŠÐµÐºÑ‚ Ð´Ð¸ÑÐ¿ÐµÑ‚Ñ‡ÐµÑ€Ð° ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹:

```go
dispatcher := events.New(
    events.WithAsyncMode(),
    events.WithWorkerCount(4),
    events.WithPanicHandler(myPanicHandler),
    events.WithErrorHandler(myErrorHandler),
)
```

### ÐŸÐ¾Ð´Ð´ÐµÑ€Ð¶Ð¸Ð²Ð°ÐµÐ¼Ñ‹Ðµ Ñ‚Ð¸Ð¿Ñ‹ ÑÐ»ÑƒÑˆÐ°Ñ‚ÐµÐ»ÐµÐ¹

**1. Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ:**
```go
fn := func(ctx context.Context, event MyEvent) error {
    // Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ°
    return nil
}
dispatcher.Subscribe((*MyEvent)(nil), fn)
```

**2. Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ñ Ð¼ÐµÑ‚Ð¾Ð´Ð¾Ð¼ `Handle`:**
```go
type MyHandler struct{}

func (h MyHandler) Handle(ctx context.Context, event MyEvent) error {
    // Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ°
    return nil
}

dispatcher.Subscribe((*MyEvent)(nil), MyHandler{})
```

### ÐŸÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸Ñ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ð¹

```go
err := dispatcher.Publish(ctx, MyEvent{ID: 42})
```

Ð¡Ð¾Ð±Ñ‹Ñ‚Ð¸Ðµ Ð´Ð¾ÑÑ‚Ð°Ð²Ð»ÑÐµÑ‚ÑÑ Ð²ÑÐµÐ¼ Ð¿Ð¾Ð´Ð¿Ð¸ÑÐ°Ð½Ð½Ñ‹Ð¼ ÑÐ»ÑƒÑˆÐ°Ñ‚ÐµÐ»ÑÐ¼, ÑÐ¾Ð¾Ñ‚Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ð¼ ÐµÐ³Ð¾ Ñ‚Ð¸Ð¿Ñƒ.

---

## ðŸ§ª ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ñ

### Ð‘Ð°Ð·Ð¾Ð²Ñ‹Ð¹ Ð¿Ñ€Ð¸Ð¼ÐµÑ€

```go
package main

import (
	"context"
	"log/slog"

	"github.com/shuldan/events"
)

type UserCreated struct {
	ID   int
	Name string
}

func main() {
	dispatcher := events.New(events.WithAsyncMode())
	defer dispatcher.Close()

	// ÐŸÐ¾Ð´Ð¿Ð¸ÑÑ‹Ð²Ð°ÐµÐ¼ Ñ„ÑƒÐ½ÐºÑ†Ð¸ÑŽ
	fn := func(ctx context.Context, event UserCreated) error {
		slog.Info("User created", "id", event.ID, "name", event.Name)
		return nil
	}

	err := dispatcher.Subscribe((*UserCreated)(nil), fn)
	if err != nil {
		panic(err)
	}

	// ÐŸÑƒÐ±Ð»Ð¸ÐºÑƒÐµÐ¼ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ðµ
	err = dispatcher.Publish(context.Background(), UserCreated{ID: 1, Name: "Alice"})
	if err != nil {
		slog.Error("Failed to publish event", "error", err)
	}
}
```

### Ð¡Ð¸Ð½Ñ…Ñ€Ð¾Ð½Ð½Ð°Ñ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ° Ñ Ð³Ð°Ñ€Ð°Ð½Ñ‚Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ñ‹Ð¼ Ð¿Ð¾Ñ€ÑÐ´ÐºÐ¾Ð¼

```go
dispatcher := events.New(events.WithSyncMode())
// Ð’ÑÐµ ÑÐ¾Ð±Ñ‹Ñ‚Ð¸Ñ Ð±ÑƒÐ´ÑƒÑ‚ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð½Ñ‹ Ð½ÐµÐ¼ÐµÐ´Ð»ÐµÐ½Ð½Ð¾ Ð¸ Ð² Ð¿Ð¾Ñ€ÑÐ´ÐºÐµ Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸Ð¸
```

### ÐšÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ð¹ Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚Ñ‡Ð¸Ðº Ð¿Ð°Ð½Ð¸Ðº

```go
type myPanicHandler struct{}

func (h *myPanicHandler) Handle(event any, listener any, panicValue any, stack []byte) {
    slog.Error("Panic in event handler",
        "event", event,
        "listener", listener,
        "panic", panicValue,
    )
}

dispatcher := events.New(events.WithPanicHandler(&myPanicHandler{}))
```

---

## ðŸ“„ Ð›Ð¸Ñ†ÐµÐ½Ð·Ð¸Ñ

Ð Ð°ÑÐ¿Ñ€Ð¾ÑÑ‚Ñ€Ð°Ð½ÑÐµÑ‚ÑÑ Ð¿Ð¾Ð´ Ð»Ð¸Ñ†ÐµÐ½Ð·Ð¸ÐµÐ¹ [MIT](LICENSE).

---

## ðŸ¤ Ð’ÐºÐ»Ð°Ð´ Ð² Ð¿Ñ€Ð¾ÐµÐºÑ‚

PR Ð¸ issue Ð¿Ñ€Ð¸Ð²ÐµÑ‚ÑÑ‚Ð²ÑƒÑŽÑ‚ÑÑ! ÐžÐ±ÑÐ·Ð°Ñ‚ÐµÐ»ÑŒÐ½Ð¾ ÑÐ¾Ð±Ð»ÑŽÐ´Ð°Ð¹Ñ‚Ðµ ÑÑ‚Ð¸Ð»ÑŒ ÐºÐ¾Ð´Ð°, Ð¿Ð¾ÐºÑ€Ñ‹Ð²Ð°Ð¹Ñ‚Ðµ Ð½Ð¾Ð²Ñ‹Ð¹ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð» Ñ‚ÐµÑÑ‚Ð°Ð¼Ð¸ Ð¸ Ð·Ð°Ð¿ÑƒÑÐºÐ°Ð¹Ñ‚Ðµ `make all` Ð¿ÐµÑ€ÐµÐ´ Ð¾Ñ‚Ð¿Ñ€Ð°Ð²ÐºÐ¾Ð¹.

---

> **ÐÐ²Ñ‚Ð¾Ñ€**: MSeytumerov  
> **Ð ÐµÐ¿Ð¾Ð·Ð¸Ñ‚Ð¾Ñ€Ð¸Ð¹**: `github.com/shuldan/events`  
> **Go**: `1.24.2`